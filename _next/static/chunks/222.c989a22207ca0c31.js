(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{2222:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SimulationCanvas:()=>P});var r=n(5896),a=n(5118),i=n(472),o=n(3684),l=n(12),s=n(4547);let u=parseInt(s.sPf.replace(/\D+/g,""));class c extends s.BKk{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${u>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}let f=e=>new s.Pq0().setFromSpherical(new s.YHV(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),m=o.forwardRef(({radius:e=100,depth:t=50,count:n=5e3,saturation:r=0,factor:a=4,fade:i=!1,speed:u=1},m)=>{let d=o.useRef(null),[p,h,g]=o.useMemo(()=>{let i=[],o=[],l=Array.from({length:n},()=>(.5+.5*Math.random())*a),u=new s.Q1f,c=e+t,m=t/n;for(let e=0;e<n;e++)c-=m*Math.random(),i.push(...f(c).toArray()),u.setHSL(e/n,r,.9),o.push(u.r,u.g,u.b);return[new Float32Array(i),new Float32Array(o),new Float32Array(l)]},[n,t,a,e,r]);(0,l.D)(e=>d.current&&(d.current.uniforms.time.value=e.clock.elapsedTime*u));let[x]=o.useState(()=>new c);return o.createElement("points",{ref:m},o.createElement("bufferGeometry",null,o.createElement("bufferAttribute",{attach:"attributes-position",args:[p,3]}),o.createElement("bufferAttribute",{attach:"attributes-color",args:[h,3]}),o.createElement("bufferAttribute",{attach:"attributes-size",args:[g,1]})),o.createElement("primitive",{ref:d,object:x,attach:"material",blending:s.EZo,"uniforms-fade-value":i,depthWrite:!1,transparent:!0,vertexColors:!0}))});var d=n(4651),p=n.n(d);function h(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function g({showPanel:e=0,className:t,parent:n}){let r=function(e,t=[],n){let[r,a]=o.useState();return o.useLayoutEffect(()=>{let t=e();return a(t),h(void 0,t),()=>h(void 0,null)},t),r}(()=>new(p()),[]);return o.useEffect(()=>{if(r){let a=n&&n.current||document.body;r.showPanel(e),null==a||a.appendChild(r.dom);let i=(null!=t?t:"").split(" ").filter(e=>e);i.length&&r.dom.classList.add(...i);let o=(0,l.j)(()=>r.begin()),s=(0,l.k)(()=>r.end());return()=>{i.length&&r.dom.classList.remove(...i),null==a||a.removeChild(r.dom),o(),s()}}},[n,r,t,e]),null}let x=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function v(e,t){let n=(0,l.C)(e=>e.gl),r=(0,l.G)(s.Tap,x(e)?Object.values(e):e);return(0,o.useLayoutEffect)(()=>{null==t||t(r)},[t]),(0,o.useEffect)(()=>{if("initTexture"in n){let e=[];Array.isArray(r)?e=r:r instanceof s.gPd?e=[r]:x(r)&&(e=Object.values(r)),e.forEach(e=>{e instanceof s.gPd&&n.initTexture(e)})}},[n,r]),(0,o.useMemo)(()=>{if(!x(e))return r;{let t={},n=0;for(let a in e)t[a]=r[n++];return t}},[e,r])}v.preload=e=>l.G.preload(s.Tap,e),v.clear=e=>l.G.clear(s.Tap,e);let M={RADIUS_KM:6371,ROTATION_RATE:72921159e-12},S={KM_TO_SCENE:1};var E=n(6651);function y(){let e=(0,o.useRef)(null),t=M.RADIUS_KM*S.KM_TO_SCENE,n=E.F.useSelector(e=>e.context.parameters.showAtmosphere),a=v("".concat("/orbital-ring","/textures/earth_daymap.jpg")),i=(0,o.useMemo)(()=>new s.BKk({vertexShader:"\n  varying vec3 vNormal;\n  varying vec3 vPosition;\n  void main() {\n    vNormal = normalize(normalMatrix * normal);\n    vPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",fragmentShader:"\n  varying vec3 vNormal;\n  varying vec3 vPosition;\n  void main() {\n    float intensity = pow(0.7 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0);\n    gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0) * intensity;\n  }\n",blending:s.EZo,side:s.hsX,transparent:!0}),[]);return(0,l.D)((t,n)=>{e.current&&(e.current.rotation.y+=M.ROTATION_RATE*n)}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{ref:e,children:[(0,r.jsx)("sphereGeometry",{args:[t,64,64]}),(0,r.jsx)("meshStandardMaterial",{map:a,roughness:.8})]}),n&&(0,r.jsx)("mesh",{material:i,children:(0,r.jsx)("sphereGeometry",{args:[1.02*t,64,64]})})]})}let _=(0,o.createContext)(null),j=new s.Pq0;function A(e){let{children:t}=e,n=(0,o.useRef)(null),a=(0,o.useRef)(new s.Pq0),{controls:i}=(0,l.C)(),u=(0,o.useRef)({getWorldOrigin:()=>a.current}).current;return(0,l.D)(e=>{let{camera:t}=e;n.current&&t.position.length()>1e3&&(j.copy(t.position),a.current.add(j),n.current.position.sub(j),t.position.set(0,0,0),i&&"target"in i&&i.target.sub(j))},-100),(0,r.jsx)(_.Provider,{value:u,children:(0,r.jsx)("group",{ref:n,children:t})})}function w(e){let{tubularSegments:t=256,radialSegments:n=32}=e,a=(0,o.useRef)(null),i=E.F.useSelector(e=>e.context.parameters.altitude),u=E.F.useSelector(e=>"running"===e.value),c=(M.RADIUS_KM+i)*S.KM_TO_SCENE,f=(0,o.useMemo)(()=>new s.O3Y(c,2*S.KM_TO_SCENE,n,t),[c,n,t]);return(0,l.D)((e,t)=>{a.current&&u&&(a.current.rotation.z+=.01*t)}),(0,r.jsx)("mesh",{ref:a,geometry:f,rotation:[Math.PI/2,0,0],children:(0,r.jsx)("meshStandardMaterial",{color:"#4fc3f7",emissive:"#1565c0",emissiveIntensity:.3,metalness:.8,roughness:.2})})}function b(e){let{maxVisible:t}=e,n=E.F.useSelector(e=>e.context.parameters.altitude),a=E.F.useSelector(e=>e.context.parameters.tetherCount),i=E.F.useSelector(e=>e.context.parameters.showTethers),l=t?Math.min(a,t):a,u=(0,o.useMemo)(()=>{let e=M.RADIUS_KM*S.KM_TO_SCENE,t=(M.RADIUS_KM+n)*S.KM_TO_SCENE,r=[];for(let n=0;n<l;n++){let a=n/l*Math.PI*2,i=Math.cos(a),o=Math.sin(a);r.push(i*e,0,o*e),r.push(i*t,0,o*t)}let a=new s.LoY;return a.setAttribute("position",new s.qtW(r,3)),a},[n,l]);return i&&0!==l?(0,r.jsx)("lineSegments",{geometry:u,children:(0,r.jsx)("lineBasicMaterial",{color:"#ffffff",opacity:.2,transparent:!0})}):null}let D={DETAIL:100,CLOSE:1e3,MEDIUM:1e4};function C(e,t,n){let r=["DETAIL","CLOSE","MEDIUM","FAR"],a=r.indexOf(t);return r.indexOf(n)<a?.9*e:1.1*e}function R(){let e=E.F.useSelector(e=>e.context.parameters.altitude),t=(M.RADIUS_KM+e)*S.KM_TO_SCENE,n=(0,o.useMemo)(()=>{let e=[];for(let n=0;n<=128;n++){let r=n/128*Math.PI*2;e.push(new s.Pq0(Math.cos(r)*t,0,Math.sin(r)*t))}return new s.LoY().setFromPoints(e)},[t]);return(0,r.jsx)("lineLoop",{geometry:n,children:(0,r.jsx)("lineBasicMaterial",{color:"#4fc3f7",linewidth:2})})}function T(){let[e,t]=(0,o.useState)("FAR"),{getWorldOrigin:n}=function(){let e=(0,o.useContext)(_);if(!e)throw Error("useWorldOrigin must be used inside CameraRelativeGroup");return e}(),a=E.F.useSelector(e=>e.context.parameters.altitude),i=(M.RADIUS_KM+a)*S.KM_TO_SCENE;return(0,o.useRef)(new s.Pq0),(0,l.D)(r=>{var a;let{camera:o}=r,l=n(),u=o.position.clone().add(l),c=Math.abs(new s.I9Y(u.x,u.z).length()-i),f=(a=Math.sqrt(c*c+u.y*u.y),a<C(D.DETAIL,e,"DETAIL")?"DETAIL":a<C(D.CLOSE,e,"CLOSE")?"CLOSE":a<C(D.MEDIUM,e,"MEDIUM")?"MEDIUM":"FAR");f!==e&&t(f)}),(0,r.jsxs)("group",{children:["FAR"===e&&(0,r.jsx)(R,{}),"MEDIUM"===e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w,{tubularSegments:64,radialSegments:8}),(0,r.jsx)(b,{maxVisible:200})]}),"CLOSE"===e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w,{tubularSegments:128,radialSegments:16}),(0,r.jsx)(b,{maxVisible:500})]}),"DETAIL"===e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w,{tubularSegments:256,radialSegments:32}),(0,r.jsx)(b,{})]})]})}function I(){let e=E.F.useActorRef();return(0,o.useEffect)(()=>{e.send({type:"LOADED"})},[e]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("ambientLight",{intensity:.1}),(0,r.jsx)("directionalLight",{position:[5e4,3e4,5e4],intensity:1.5}),(0,r.jsx)(i.N,{makeDefault:!0,minDistance:M.RADIUS_KM*S.KM_TO_SCENE*1.01,maxDistance:M.RADIUS_KM*S.KM_TO_SCENE*5,enableDamping:!0,dampingFactor:.05}),(0,r.jsxs)(A,{children:[(0,r.jsx)(m,{radius:1e5,depth:5e4,count:5e3,factor:100,saturation:0}),(0,r.jsx)(y,{}),(0,r.jsx)(T,{})]}),(0,r.jsx)(g,{})]})}function P(){return(0,r.jsx)(a.Hl,{camera:{position:[0,0,M.RADIUS_KM*S.KM_TO_SCENE*2.5],fov:45,near:.1,far:1e6},gl:{logarithmicDepthBuffer:!0,antialias:!0},style:{width:"100%",height:"100%"},children:(0,r.jsx)(I,{})})}},4651:function(e){var t;(t=function(){function e(e){return a.appendChild(e.dom),e}function n(e){for(var t=0;t<a.children.length;t++)a.children[t].style.display=t===e?"block":"none";r=e}var r=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(e){e.preventDefault(),n(++r%a.children.length)},!1);var i=(performance||Date).now(),o=i,l=0,s=e(new t.Panel("FPS","#0ff","#002")),u=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:a,addPanel:e,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){l++;var e=(performance||Date).now();if(u.update(e-i,200),e>o+1e3&&(s.update(1e3*l/(e-o),100),o=e,l=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:a,setMode:n}}).Panel=function(e,t,n){var r=1/0,a=0,i=Math.round,o=i(window.devicePixelRatio||1),l=80*o,s=48*o,u=3*o,c=2*o,f=3*o,m=15*o,d=74*o,p=30*o,h=document.createElement("canvas");h.width=l,h.height=s,h.style.cssText="width:80px;height:48px";var g=h.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,l,s),g.fillStyle=t,g.fillText(e,u,c),g.fillRect(f,m,d,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(f,m,d,p),{dom:h,update:function(s,x){r=Math.min(r,s),a=Math.max(a,s),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,l,m),g.fillStyle=t,g.fillText(i(s)+" "+e+" ("+i(r)+"-"+i(a)+")",u,c),g.drawImage(h,f+o,m,d-o,p,f,m,d-o,p),g.fillRect(f+d-o,m,o,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(f+d-o,m,o,i((1-s/x)*p))}}},e.exports=t}}]);